
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

Функция ДобавитьКомандуСоздатьНаОсновании(КомандыСозданияНаОсновании) Экспорт
	
	Если ПравоДоступа("Добавление", Метаданные.Документы.РеализацияТоваровУслуг) Тогда
		
        КомандаСоздатьНаОсновании = КомандыСозданияНаОсновании.Добавить();
        КомандаСоздатьНаОсновании.Менеджер = Метаданные.Документы.РеализацияТоваровУслуг.ПолноеИмя();
        КомандаСоздатьНаОсновании.Представление = ОбщегоНазначения.ПредставлениеОбъекта(Метаданные.Документы.РеализацияТоваровУслуг);
        КомандаСоздатьНаОсновании.РежимЗаписи = "Проводить";
		
		Возврат КомандаСоздатьНаОсновании;
		
	КонецЕсли;

	Возврат Неопределено;
	
КонецФункции

//ВКМ_НачалоДоработки_СмирноваСветлана_27.02.2024_Диплом
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	
	КомандаПечати = КомандыПечати.Добавить();
	КомандаПечати.Идентификатор = "ВКМ_Док_АктОбОказанииУслуг";
	КомандаПечати.Представление = НСтр("ru = 'АктОбОказанииУслуг'");
	КомандаПечати.Порядок = 1;
	
КонецПроцедуры //ВКМ_ОкончаниеДоработки

//ВКМ_НачалоДоработки_СмирноваСветлана_27.02.2024_Диплом
Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
	
	ПечатнаяФорма = УправлениеПечатью.СведенияОПечатнойФорме(КоллекцияПечатныхФорм, "ВКМ_Док_АктОбОказанииУслуг");
	Если ПечатнаяФорма <> Неопределено Тогда
		ОфисныеДокументы = НапечататьДоговорDOCX(МассивОбъектов);
	    ПечатнаяФорма.СинонимМакета = НСтр("ru = 'Договор (MS Word)'");
	    ПечатнаяФорма.ОфисныеДокументы = ОфисныеДокументы;
	КонецЕсли;
	
КонецПроцедуры //ВКМ_ОкончаниеДоработки

#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

//ВКМ_НачалоДоработки_СмирноваСветлана_27.02.2024_Диплом
 Функция НапечататьДоговорDOCX(МассивОбъектов)
	 
	 Для Каждого Элемент из МассивОбъектов Цикл	
		ДокСсылка = Элемент.Ссылка;
	КонецЦикла;
	
	ДанныеДокумента = ДанныеДляПечатиДоговора(ДокСсылка);
	
    ОфисныеДокументы = Новый Соответствие;
    
    МакетДокумента = УправлениеПечатью.МакетПечатнойФормы("Документ.РеализацияТоваровУслуг.ВКМ_Док_АктОбОказанииУслуг");
    Макет = УправлениеПечатью.ИнициализироватьМакетОфисногоДокумента(МакетДокумента, Неопределено);  
        
    ОписаниеОбластей = Новый Структура;
    УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "Шапка", "Общая");
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "ТЧШапка", "Общая");
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "ТЧСтрока", "СтрокаТаблицы");
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "Подвал", "Общая");
	    
	ПечатнаяФорма = УправлениеПечатью.ИнициализироватьПечатнуюФорму(Неопределено, Неопределено, Макет);
	    
	Шапка = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["Шапка"]);
	УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Шапка, ДанныеДокумента.ШапкаДок);
		
	ТЧШапка = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["ТЧШапка"]);
	УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, ТЧШапка, ДанныеДокумента.ШапкаДок); 
				
	ТЧСтрока = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["ТЧСтрока"]);
	
	Для Каждого Данные Из ДанныеДокумента.ТЧДок Цикл  
		УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, ТЧСтрока, Данные);
	КонецЦикла;
	
	Подвал = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["Подвал"]);
	УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Подвал, ДанныеДокумента.ШапкаДок);
		
	АдресХранилищаПечатнойФормы = УправлениеПечатью.СформироватьДокумент(ПечатнаяФорма);
	ОфисныеДокументы.Вставить(АдресХранилищаПечатнойФормы, Строка(ДокСсылка));
	УправлениеПечатью.ОчиститьСсылки(ПечатнаяФорма);
	
    УправлениеПечатью.ОчиститьСсылки(Макет);
    
    Возврат ОфисныеДокументы;
    
КонецФункции //ВКМ_ОкончаниеДоработки

//ВКМ_НачалоДоработки_СмирноваСветлана_27.02.2024_Диплом
Функция ДанныеДляПечатиДоговора(ДокСсылка)
	
	ДанныеОтвета = Новый Структура("ШапкаДок, ТЧДок");
	ТЧДок = Новый Массив;
	
	УстановитьПривилегированныйРежим(Истина);
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РеализацияТоваровУслуг.Ссылка КАК Ссылка,
		|	РеализацияТоваровУслуг.Организация КАК Организация,
		|	РеализацияТоваровУслуг.Контрагент КАК Контрагент,
		|	РеализацияТоваровУслуг.Договор КАК Договор,
		|	РеализацияТоваровУслугТовары.Номенклатура КАК Номенклатура,
		|	РеализацияТоваровУслугТовары.Количество КАК Количество,
		|	РеализацияТоваровУслугТовары.Цена КАК Цена,
		|	РеализацияТоваровУслугТовары.Сумма КАК Сумма,
		|	РеализацияТоваровУслуг.Номер КАК Номер,
		|	РеализацияТоваровУслуг.Дата КАК Дата,
		|	РеализацияТоваровУслуг.СуммаДокумента КАК СуммаДокумента
		|ИЗ
		|	Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
		|		ПО РеализацияТоваровУслугТовары.Ссылка = РеализацияТоваровУслуг.Ссылка
		|ГДЕ
		|	РеализацияТоваровУслуг.Ссылка = &Ссылка";
	
	Запрос.УстановитьПараметр("Ссылка", ДокСсылка);
		
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		ШапкаДок = Новый Структура;
		ШапкаДок.Вставить("Ссылка", Выборка.Ссылка);
		ШапкаДок.Вставить("Номер", Выборка.Номер);
		ШапкаДок.Вставить("Дата", Выборка.Дата);
		ШапкаДок.Вставить("Организация", Выборка.Организация);
		ШапкаДок.Вставить("Контрагент", Выборка.Контрагент);
		ШапкаДок.Вставить("Договор", Выборка.Договор);
		ШапкаДок.Вставить("СуммаДокумента", Выборка.СуммаДокумента);
			ФормСтрока = "Л = ru_RU; ДП = Истина";
			ПарПредмета="рубль,рубля,рублей,м,копейка,копейки,копеек,ж,2";
			СуммаПрописью = ЧислоПрописью(Выборка.СуммаДокумента, ФормСтрока, ПарПредмета);
		ШапкаДок.Вставить("СуммаПрописью", СуммаПрописью);
		
		ДанныеТЧ = Новый Структура;
		ДанныеТЧ.Вставить("Номенклатура", Выборка.Номенклатура);
		ДанныеТЧ.Вставить("Количество", Выборка.Количество);
		ДанныеТЧ.Вставить("Цена", Выборка.Цена);
		ДанныеТЧ.Вставить("Сумма", Выборка.Сумма);
		
		
		ТЧДок.Добавить(ДанныеТЧ);
		
	КонецЦикла;
	
	ДанныеОтвета.Вставить("ШапкаДок", ШапкаДок);
	ДанныеОтвета.Вставить("ТЧДок", ТЧДок);

	
	Возврат ДанныеОтвета;
	
КонецФункции //ВКМ_ОкончаниеДоработки

#КонецОбласти

#КонецЕсли